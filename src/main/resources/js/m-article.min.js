var Comment={editor:void 0,loadEmojis:function(){let t=Comment.getEmojis(),i="";for(let e=0;e<t.length;e++)i+=`<button onclick="Comment.editor.setValue(Comment.editor.getValue() + '![图片表情](${t[e]})')">
    <div class="divX"><svg onclick='Comment.delEmoji("${t[e]}");event.cancelBubble =true;' style="width: 15px; height: 15px;"><use xlink:href="#delIcon"></use></svg></div>
    <img style='max-height: 50px' class="vditor-emojis__icon" src="${t[e]}">
</button>`;$("#emojis").html(i)},confirmed:!1,delEmoji:function(i){if(!0===Comment.confirmed||confirm("确定要删除该表情包吗？")){Comment.confirmed=!0;let t=Comment.getEmojis();for(let e=0;e<t.length;e++)t[e]===i&&t.splice(e,1);t.reverse(),$.ajax({url:Label.servePath+"/api/cloud/sync",method:"POST",data:JSON.stringify({gameId:"emojis",data:t}),headers:{csrfToken:Label.csrfToken},async:!1,success:function(e){0===e.code?(Util.notice("success",1500,"表情包删除成功。"),Comment.loadEmojis(),setTimeout(function(){$("#emojiBtn").click()},50)):Util.notice("warning",1500,"表情包删除失败："+e.msg)}})}},listenUploadEmojis:function(){$("#uploadEmoji").fileupload({acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:5242880,multipart:!0,pasteZone:null,dropZone:null,url:Label.servePath+"/upload",paramName:"file[]",add:function(e,i){var t;ext=i.files[0].type.split("/")[1],window.File&&window.FileReader&&window.FileList&&window.Blob?((t=new FileReader).readAsArrayBuffer(i.files[0]),t.onload=function(e){var t=new Uint8Array(e.target.result.slice(0,11));isImage(t)?5242880<e.target.result.byteLength?Util.alert("图片过大 (最大限制 5M)"):i.submit():Util.alert("只允许上传图片!")}):i.submit()},formData:function(e){return e.serializeArray()},submit:function(e,t){},done:function(e,t){t={result:{key:t.result.data.succMap[Object.keys(t.result.data.succMap)[0]]}};Comment.addEmoji(t.result.key)},fail:function(e,t){Util.alert("Upload error: "+t.errorThrown)}})},fromURL:function(){Util.alert('<div class="form fn__flex-column">\n<label>\n  <div class="ft__smaller ft__fade" style="float: left">请输入图片的URL</div>\n  <div class="fn-hr5 fn__5"></div>\n  <input type="text" id="fromURL">\n</label>\n<div class="fn-hr5"></div>\n<div class="fn__flex" style="margin-top: 15px; justify-content: flex-end;">\n  <button class="btn btn--confirm" onclick=\'Comment.addEmoji($("#fromURL").val());Util.closeAlert();\'>导入</button>\n</div>\n</div>',"从URL导入表情包"),$("#fromURL").focus(),$("#fromURL").unbind(),$("#fromURL").bind("keypress",function(e){"13"==e.keyCode&&(Comment.addEmoji($("#fromURL").val()),Util.closeAlert())})},addEmoji:function(){for(let e=0;e<arguments.length;e++){var i=arguments[e];let t=Comment.getEmojis();t.reverse();for(let e=0;e<t.length;e++)t[e]===i&&t.splice(e,1);t.push(i),$.ajax({url:Label.servePath+"/api/cloud/sync",method:"POST",data:JSON.stringify({gameId:"emojis",data:t}),headers:{csrfToken:Label.csrfToken},async:!1,success:function(e){0!==e.code&&Util.notice("warning",1500,"表情包上传失败："+e.msg)}})}Util.notice("success",1500,"表情包上传成功。"),$("details[open]").removeAttr("open"),Comment.loadEmojis()},getEmojis:function(){let t;return $.ajax({url:Label.servePath+"/api/cloud/get",method:"POST",data:JSON.stringify({gameId:"emojis"}),headers:{csrfToken:Label.csrfToken},async:!1,success:function(e){t=0===e.code&&""!==e.data?Util.parseArray(e.data):[]}}),t.reverse(),t},report:function(e){var t=$(e);t.attr("disabled","disabled").css("opacity","0.3"),$.ajax({url:Label.servePath+"/report",type:"POST",cache:!1,data:JSON.stringify({reportDataId:$("#reportDialog").data("id"),reportDataType:$("#reportDialog").data("type"),reportType:$("input[name=report]:checked").val(),reportMemo:$("#reportTextarea").val()}),complete:function(e){t.removeAttr("disabled").css("opacity","1"),0===e.responseJSON.code?(Util.alert(Label.reportSuccLabel),$("#reportTextarea").val(""),$("#reportDialog").dialog("close")):Util.alert(e.responseJSON.msg)}})},accept:function(e,t,i){confirm(e)&&$.ajax({url:Label.servePath+"/comment/accept",type:"POST",headers:{csrfToken:Label.csrfToken},cache:!1,data:JSON.stringify({commentId:t}),success:function(e){0!==e.code?Util.alert(e.msg):($(i).closest("li").addClass("cmt-perfect"),$(i).remove())}})},remove:function(i){if(!confirm(Label.confirmRemoveLabel))return!1;$.ajax({url:Label.servePath+"/comment/"+i+"/remove",type:"POST",cache:!1,success:function(e,t){0===e.code?$("#"+i).remove():Util.alert(e.msg)}})},exchangeCmtSort:function(e){e=0===e?1:0,window.location.href=window.location.pathname+"?m="+e},edit:function(e){$(".anonymous-check").hide(),$.ajax({url:Label.servePath+"/comment/"+e+"/content",type:"GET",cache:!1,success:function(e,t){0===e.code&&Comment.editor.setValue(e.commentContent)}}),$("#replyUseName").html('<a href="javascript:void(0)" onclick="Comment._bgFade($(\'#'+e+'\'))" class="ft-a-title"><svg><use xlink:href="#edit"></use></svg> '+Label.commonUpdateCommentPermissionLabel+"</a>").data("commentId",e)},_bgFade:function(e){return 0!==e.length&&($(window).scrollTop(e[0].offsetTop-48),"comments"!==e.attr("id")&&(e.css({"background-color":"#9bbee0"}),setTimeout(function(){e.css({"background-color":"#FFF",transition:"all 3s cubic-bezier(0.56, -0.36, 0.58, 1)"})},100),void setTimeout(function(){e.removeAttr("style")},3100)))},goComment:function(e){if(0===$(e.substr(e.length-14,14)).length)return window.location=e,!1;$("#comments .list > ul > li").removeAttr("style"),Comment._bgFade($(e.substr(e.length-14,14)))},_setCmtVia:function(){$(".cmt-via").each(function(){var e=$(this).data("ua"),e=Util.getDeviceByUa(e);""!==e&&$(this).html("via "+e)})},init:function(){if(1===$(window.location.hash).length&&Comment._bgFade($(window.location.hash)),this._setCmtVia(),$.ua.set(navigator.userAgent),$.pjax({selector:".pagination a",container:"#comments",show:"",cache:!1,storage:!0,titleSuffix:"",callback:function(){Util.parseMarkdown(),Util.parseHljs()}}),NProgress.configure({showSpinner:!1}),$("#comments").bind("pjax.start",function(){NProgress.start()}),$("#comments").bind("pjax.end",function(){NProgress.done()}),!Label.isLoggedIn)return!1;Comment.editor=Util.newVditor({id:"commentContent",cache:!0,preview:{mode:"editor"},resize:{enable:!0,position:"top"},height:200,placeholder:Label.commentEditorPlaceholderLabel,ctrlEnter:function(){Comment.add(Label.articleOId,Label.csrfToken,document.getElementById("articleCommentBtn"))}})},thank:function(e,t,i,a,s){return Label.isLoggedIn?!(0===a&&!confirm(i))&&void $.ajax({url:Label.servePath+"/comment/thank",type:"POST",headers:{csrfToken:t},cache:!1,data:JSON.stringify({commentId:e}),error:function(e,t,i){Util.alert(i)},success:function(e,t){var i,a,n;0===e.code?($(s).removeAttr("onclick"),i=$('<svg class="ft-red"><use xlink:href="#heart"></use></svg>'),a=$(s).offset().top,n=$(s).offset().left,i.css({"z-index":9999,top:a,left:n,position:"absolute","font-size":16,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),$("body").append(i),i.animate({left:n-150,top:a-60,opacity:0},1e3,function(){var e=parseInt($(s).text());$(s).html('<svg><use xlink:href="#heart"></use></svg> '+(e+1)).addClass("ft-red"),i.remove()})):Util.alert(e.msg)}}):(Util.needLogin(),!1)},showReply:function(e,o,t){var r=$(o).closest("li").find("."+t);if("comment-get-comment"===t){if(0!==r.find("li").length)return r.html(""),!1}else if(0===$(o).find(".icon-chevron-down").length)return $(o).find(".icon-chevron-up").removeClass("icon-chevron-up").addClass("icon-chevron-down").find("use").attr("xlink:href","#chevron-down"),r.html(""),!1;if("0.3"===$(o).css("opacity"))return!1;t="comment-get-comment"===t?"/comment/original":"/comment/replies";$.ajax({url:Label.servePath+t,type:"POST",data:JSON.stringify({commentId:e,userCommentViewMode:Label.userCommentViewMode}),beforeSend:function(){$(o).css("opacity","0.3")},success:function(e,t){if(0!==e.code)return Util.alert(e.msg),!1;var i=e.commentReplies,a="";0===(i=!(i instanceof Array)?[i]:i).length&&(a='<li class="ft-red">'+Label.removedLabel+"</li>");for(var n=0;n<i.length;n++){var s=i[n];a+='<li><div class="fn-flex">',a+='<a rel="nofollow" href="/member/'+s.commentAuthorName+'">',a+='<div class="avatar tooltipped tooltipped-se" aria-label="'+s.commentAuthorName+'" style="background-image:url('+s.commentAuthorThumbnailURL+')"></div>',a+="</a>",a+='<div class="fn-flex-1"><div class="comment-info ft-smaller">',a+='<a class="ft-gray" rel="nofollow" href="/member/'+s.commentAuthorName+'">',a+=s.commentAuthorName,a+="</a>",a+='<span class="ft-fade"> • '+s.timeAgo,0<s.rewardedCnt&&(a+='<span aria-label="'+(s.rewarded?Label.thankedLabel:Label.thankLabel+" "+s.rewardedCnt)+'" class="tooltipped tooltipped-n '+(s.rewarded?"ft-red":"ft-fade")+'"> <svg><use xlink:href="#heart"></use></svg> '+s.rewardedCnt+"</span> "),a+=" "+Util.getDeviceByUa(s.commentUA)+"</span>",a+='<a class="tooltipped tooltipped-nw ft-a-title fn-right" aria-label="'+Label.referenceLabel+'" href="javascript:Comment.goComment(\''+Label.servePath+"/article/"+Label.articleOId+"?p="+s.paginationCurrentPageNum+"&m="+Label.userCommentViewMode+"#"+s.oId+'\')"><svg><use xlink:href="#quote"></use></svg></a></div><div class="vditor-reset comment">'+s.commentContent+"</div></div></div></li>"}r.html("<ul>"+a+"</ul>"),Util.parseHljs(),Util.parseMarkdown(),$(o).find(".icon-chevron-down").removeClass("icon-chevron-down").addClass("icon-chevron-up").find("use").attr("xlink:href","#chevron-up")},error:function(e){Util.alert(e.statusText)},complete:function(){$(o).css("opacity","1")}})},add:function(e,t){var i={articleId:e,commentAnonymous:$("#commentAnonymous").prop("checked"),commentVisible:$("#commentVisible").prop("checked"),commentContent:Comment.editor.getValue(),userCommentViewMode:Label.userCommentViewMode};$("#replyUseName").data("commentOriginalCommentId")&&(i.commentOriginalCommentId=$("#replyUseName").data("commentOriginalCommentId"));var a=Label.servePath+"/comment",e="POST",n=$("#replyUseName").data("commentId");n&&(a=Label.servePath+"/comment/"+n,e="PUT"),$.ajax({url:a,type:e,headers:{csrfToken:t},cache:!1,data:JSON.stringify(i),beforeSend:function(){$(".form button.red").attr("disabled","disabled").css("opacity","0.3")},success:function(e,t){$(".form button.red").removeAttr("disabled").css("opacity","1"),0===e.code?(n&&$("#"+n+" > .fn-flex > .fn-flex-1 > .vditor-reset").html(e.commentContent),Comment.editor.setValue(""),$("#replyUseName").text("").removeData(),window.localStorage&&(window.localStorage[Label.articleOId]=JSON.stringify({commentContent:""})),1===Label.userCommentViewMode?Comment._bgFade($("#comments")):Comment._bgFade($("#bottomComment"))):$("#addCommentTip").addClass("error").html("<ul><li>"+e.msg+"</li></ul>")},error:function(e){$("#addCommentTip").addClass("error").html("<ul><li>"+e.statusText+"</li></ul>")},complete:function(){$(".form button.red").removeAttr("disabled").css("opacity","1")}})},reply:function(e,t){$("#replyUseName").data("commentOriginalCommentId",t),Comment.editor.focus()}},Article={initAudio:function(){$(".content-audio").each(function(){var e=$(this);new APlayer({element:this,narrow:!1,autoplay:!1,mutex:!0,theme:"#4285f4",preload:"none",mode:"circulation",music:{title:e.data("title"),author:'<a href="'+Label.servePath+'/about" target="_blank">音乐分享</a>',url:e.data("url"),pic:Label.staticServePath+"/images/music.png"}})});var e=$("#articleAudio");if(0===e.length)return!1;new APlayer({element:document.getElementById("articleAudio"),narrow:!1,autoplay:!1,mutex:!0,theme:"#4285f4",mode:"order",preload:"none",music:{title:"语音预览",author:'<a href="'+Label.servePath+'/about" target="_blank">小薇</a>',url:e.data("url"),pic:Label.staticServePath+"/images/blank.png"}})},permissionTip:function(e){Label.isLoggedIn?Util.alert(e):Util.needLogin()},voteUp:function(e,t,i){if(!Label.isLoggedIn)return Util.needLogin(),!1;var n=$(i),s=n.next();if(n.hasClass("disabled"))return!1;e={dataId:e};n.addClass("disabled"),$.ajax({url:Label.servePath+"/vote/up/"+t,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){n.removeClass("disabled");var i=parseInt(n.text()),a=parseInt(s.text());0!==e.code?Util.alert(e.msg):0===e.type?n.html('<svg class="icon-thumbs-up"><use xlink:href="#thumbs-up"></use></svg> '+(i-1)).removeClass("ft-red"):(n.html('<svg class="icon-thumbs-up"><use xlink:href="#thumbs-up"></use></svg> '+(i+1)).addClass("ft-red"),s.hasClass("ft-red")&&s.html('<svg class="icon-thumbs-down"><use xlink:href="#thumbs-down"></use></svg> '+(a-1)).removeClass("ft-red"))}})},voteDown:function(e,t,i){if(!Label.isLoggedIn)return Util.needLogin(),!1;var n=$(i),s=n.prev();if(n.hasClass("disabled"))return!1;e={dataId:e};n.addClass("disabled"),$.ajax({url:Label.servePath+"/vote/down/"+t,type:"POST",cache:!1,data:JSON.stringify(e),success:function(e,t){n.removeClass("disabled");var i=parseInt(s.text()),a=parseInt(n.text());if(0===e.code)return 1===e.type?n.html('<svg class="icon-thumbs-down"><use xlink:href="#thumbs-down"></use></svg> '+(a-1)).removeClass("ft-red"):(n.html('<svg class="icon-thumbs-down"><use xlink:href="#thumbs-down"></use></svg> '+(a+1)).addClass("ft-red"),s.hasClass("ft-red")&&s.html('<svg class="icon-thumbs-up"><use xlink:href="#thumbs-up"></use></svg> '+(i-1)).removeClass("ft-red")),!1;Util.alert(e.msg)}})},previewImgAfterLoading:function(){$(".img-preview img").css("transform","translate3d("+Math.max(0,$(window).width()-$(".img-preview img").width())/2+"px, "+Math.max(0,$(window).height()-$(".img-preview img").height())/2+"px, 0)"),setTimeout(function(){$(".img-preview").width($(window).width())},300)},init:function(){this.share(),Util.parseHljs(),Util.parseMarkdown();var t=null;$(".article").on("dblclick",".vditor-reset img",function(){clearTimeout(t),$(this).hasClass("emoji")||1===$(this).closest(".editor-panel").length||1===$(this).closest(".ad").length||window.open($(this).attr("src"))}).on("click",".vditor-reset img",function(e){var i,a;clearTimeout(t),$(this).hasClass("emoji")||1===$(this).closest(".editor-panel").length||1===$(this).closest(".ad").length||(i=$(this),a=this,t=setTimeout(function(){var e=a.offsetTop,t=a.offsetLeft;1===i.closest(".comments").length&&(e+=i.closest("li")[0].offsetTop,t=t+$(".comments")[0].offsetLeft+15),$("body").append('<div class="img-preview" onclick="$(this).remove()"><img style="transform: translate3d('+Math.max(0,t)+"px, "+Math.max(0,e-$(window).scrollTop())+'px, 0)" src="'+i.attr("src").split("?imageView2")[0]+'" onload="Article.previewImgAfterLoading()"></div>'),$(".img-preview").css({"background-color":"#fff",position:"fixed"})},100))});var e=$("#articltVia").data("ua"),e=Util.getDeviceByUa(e);""!==e&&$("#articltVia").text("via "+e),$("#revision").dialog({width:$(window).width()-50,height:$(window).height()-50,modal:!0,hideFooter:!0}),$("#reportDialog").dialog({width:500<$(window).width()?500:$(window).width()-50,height:450,modal:!0,hideFooter:!0}),this.initAudio()},revision:function(e,a){if(!Label.isLoggedIn)return Util.needLogin(),!1;a=a||"article",$.ajax({url:Label.servePath+"/"+a+"/"+e+"/revisions",cache:!1,success:function(e,t){if(0===e.code){if(0===e.revisions.length||1===e.revisions.length)return $("#revision > .revisions").remove(),$("#revisions").html("<b>"+Label.noRevisionLabel+"</b>"),!1;$("#revisions").html("").prev().remove(),$("#revisions").data("revisions",e.revisions).before('<div class="revisions"><a href="javascript:void(0)" class="first"><svg><use xlink:href="#chevron-left"</svg></a><span>'+(e.revisions.length-1)+"~"+e.revisions.length+"/"+e.revisions.length+'</span><a href="javascript:void(0)" class="disabled last"><svg><use xlink:href="#chevron-right"</svg></a></div>'),e.revisions.length<=2&&$("#revision a").first().addClass("disabled");var i=JsDiff.createPatch("",e.revisions[e.revisions.length-2].revisionData.articleContent||e.revisions[e.revisions.length-2].revisionData.commentContent,e.revisions[e.revisions.length-1].revisionData.articleContent||e.revisions[e.revisions.length-1].revisionData.commentContent,e.revisions[e.revisions.length-2].revisionData.articleTitle||"",e.revisions[e.revisions.length-1].revisionData.articleTitle||"");return new Diff2HtmlUI({diff:i}).draw("#revisions",{matching:"lines",outputFormat:"side-by-side",synchronisedScroll:!0}),Article._revisionsControls(a),!1}Util.alert(e.msg)}}),$("#revision").dialog("open")},_revisionsControls:function(e){var t=$("#revisions").data("revisions");$("#revision a.first").click(function(){var e;$(this).hasClass("disabled")||((e=parseInt($("#revision .revisions").text().split("~")[0]))<=2?$(this).addClass("disabled"):$(this).removeClass("disabled"),2<t.length&&$("#revision a.last").removeClass("disabled"),$("#revision .revisions > span").html(e-1+"~"+e+"/"+t.length),e=JsDiff.createPatch("",t[e-2].revisionData.articleContent||t[e-2].revisionData.commentContent,t[e-1].revisionData.articleContent||t[e-1].revisionData.commentContent,t[e-2].revisionData.articleTitle||"",t[e-1].revisionData.articleTitle||""),new Diff2HtmlUI({diff:e}).draw("#revisions",{matching:"lines",outputFormat:"side-by-side",synchronisedScroll:!0}))}),$("#revision a.last").click(function(){var e;$(this).hasClass("disabled")||((e=parseInt($("#revision .revisions span").text().split("~")[0]))>t.length-3?$(this).addClass("disabled"):$(this).removeClass("disabled"),2<t.length&&$("#revision a.first").removeClass("disabled"),$("#revision .revisions > span").html(e+1+"~"+(e+2)+"/"+t.length),e=JsDiff.createPatch("",t[e].revisionData.articleContent||t[e].revisionData.commentContent,t[e+1].revisionData.articleContent||t[e+1].revisionData.commentContent,t[e].revisionData.articleTitle||"",t[e+1].revisionData.articleTitle||""),new Diff2HtmlUI({diff:e}).draw("#revisions",{matching:"lines",outputFormat:"side-by-side",synchronisedScroll:!0}))})},share:function(){var e;"mobile"!==$.ua.device.type&&(e=$(".article-content").offset().left/2-15,$(".share").css("left",(e<20?20:e)+"px"));var n=$("#qrCode").data("shareurl");$("#qrCode").qrcode({width:90,height:90,text:n}),$("body").click(function(){$("#qrCode").slideUp()}),$(".share > span").click(function(){var e=$(this).data("type");if(!e)return!1;if("wechat"===e)return $("#qrCode").slideToggle(),!1;if("copy"===e)return!1;var t=encodeURIComponent(Label.articleTitle+" - "+Label.symphonyLabel),i=encodeURIComponent(n),a=$(".article-info .avatar").css("background-image");pic=a.substring(5,a.length-2);a={};a.tencent="http://share.v.t.qq.com/index.php?c=share&a=index&title="+t+"&url="+i+"&pic="+pic,a.weibo="http://v.t.sina.com.cn/share/share.php?title="+t+"&url="+i+"&pic="+pic,a.google="https://plus.google.com/share?url="+i,a.twitter="https://twitter.com/intent/tweet?status="+t+" "+i,window.open(a[e],"_blank","top=100,left=200,width=648,height=618")}),$("#qrCode").click(function(){$(this).hide()}),$("#shareClipboard").mouseover(function(){$(this).attr("aria-label",Label.copyLabel)}),Util.clipboard($("#shareClipboard"),$("#shareClipboard").next(),function(){$("#shareClipboard").attr("aria-label",Label.copiedLabel)})},reward:function(e){confirm(Label.rewardConfirmLabel)&&$.ajax({url:Label.servePath+"/article/reward?articleId="+e,type:"POST",cache:!1,success:function(e,t){0!==e.code?Util.alert(e.msg):($("#articleRewardContent").html(e.articleRewardContent),Util.parseHljs(),Util.parseMarkdown(),e=parseInt($(".article-actions .icon-points").parent().text()),$(".article-actions .icon-points").parent().addClass("ft-red").html('<svg><use xlink:href="#points"></use></svg> '+(e+1)).removeAttr("onclick"))},error:function(e){Util.needLogin()}})},thankArticle:function(e,t){return Label.isLoggedIn?!(0===t&&!confirm(Label.thankArticleConfirmLabel))&&(Label.currentUserName===Label.articleAuthorName?(Util.alert(Label.thankSelfLabel),!1):void $.ajax({url:Label.servePath+"/article/thank?articleId="+e,type:"POST",cache:!1,success:function(e,t){if(0===e.code){var i=parseInt($("#thankArticle").text());$("#thankArticle").removeAttr("onclick").html('<svg><use xlink:href="#heart"></use></svg> <span class="ft-13">'+(i+1)+"</span>").addClass("ft-red").removeClass("ft-blue");var a=$('<svg class="ft-red"><use xlink:href="#heart"></use></svg>'),n=$("#thankArticle").offset().top,i=$("#thankArticle").offset().left;return a.css({"z-index":9999,top:n-20,left:i,position:"absolute","font-size":16,"-moz-user-select":"none","-webkit-user-select":"none","-ms-user-select":"none"}),$("body").append(a),a.animate({top:n-180,opacity:0},1500,function(){a.remove()}),!1}Util.alert(e.msg)}})):(Util.needLogin(),!1)},stick:function(e){confirm(Label.stickConfirmLabel)&&$.ajax({url:Label.servePath+"/article/stick?articleId="+e,type:"POST",cache:!1,success:function(e,t){Util.alert(e.msg),window.location.href=Label.servePath+"/recent"}})},playThought:function(e){function i(e,t){var i=e.split(l);3===i.length&&i.splice(0,0,"");var e=i[0],a=i[2].split("-"),n=i[3].split("-");if(a[0]=parseInt(a[0]),a[1]=parseInt(a[1]),n[0]=parseInt(n[0]),n[1]=parseInt(n[1]),e===d){for(var s=[],o=a[1];n[1],o<t.length;o++,0){if(a[1]===n[1]){t[o]=t[o].substring(0,a[0])+t[o].substr(n[0]);break}o===a[1]?t[o]=t[o].substr(0,a[0]):o===n[1]?(t[a[1]]+=t[o].substr(n[0]),t.splice(o,1)):s.push(o)}for(var r=0;r<s.length;r++)t.splice(s[r]-r,1)}else{i=e.split(c)[0];""===e.split(c)[1]&&(t[a[1]]=t[a[1]].substring(0,a[0])+t[n[1]].substr(n[0]),t.splice(a[1]+1,n[1]-a[1])),void 0!==t[a[1]]?t[a[1]]=t[a[1]].substring(0,a[0])+i+t[a[1]].substr(a[0]):t[a[1]]=""}return t}var l=String.fromCharCode(31),t=String.fromCharCode(30),c=String.fromCharCode(29),a=String.fromCharCode(10),d=String.fromCharCode(24),n=$("#thoughtProgress > span"),s=$("#thoughtProgress > svg"),o="#articleThought",r=e.split(t),m=Math.max(r[r.length-2].split(l)[1]/3e4,2);""===r[r.length-1]&&r.pop();for(var u=0,h=0;u<r.length;u++)setTimeout(function(){$(o).data("text")||$(o).data("text","");var e=i(r[h++],$(o).data("text").split(a)).join(a),t=e.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/	/g,"&nbsp;&nbsp;&nbsp;&nbsp;");$(o).data("text",e).html(t)},parseInt(r[u].split(l)[1])/m);for(var f=0,p=parseInt(r[u-1].split(l)[1])/m,v=setInterval(function(){p<=f?(n.width("100%"),s.css("left","100%"),clearInterval(v)):(f+=20,s.css("left",100*f/p+"%"),n.width(100*f/p+"%"))},20),g="",b="",C=0,w=0,L=0;w<r.length;w++){var y=i(r[L++],g.split(a)).join(a),b=y.replace(/\n/g,"<br>").replace(/ /g,"&nbsp;").replace(/	/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),g=y;$(o).html(b),C=Math.max(C,$(o).height())}$("#thoughtProgressPreview").html('<div class="vditor-reset">'+b+"</div>"),$("#thoughtProgressPreview").dialog({modal:!0,hideFooter:!0}),s.click(function(){$("#thoughtProgressPreview").dialog("open")}),$(o).html(b).height(C).css("margin-bottom","15px").html("")},makeNotificationRead:function(e,t){$.ajax({url:Label.servePath+"/notifications/make-read",type:"POST",cache:!1,data:JSON.stringify({articleId:e,commentIds:t})})}};Article.init(),$(document).ready(function(){Comment.init(),Comment.listenUploadEmojis(),Comment.loadEmojis(),$("#emojiBtn").on("click",function(){$("#emojiList").hasClass("showList")?$("#emojiList").removeClass("showList"):($("#emojiList").addClass("showList"),setTimeout(function(){$("body").unbind(),$("body").click(function(e){"aPersonListPanel"!==$(e.target).closest("a").attr("id")&&"personListPanel"!==$(e.target).closest(".module").attr("id")&&$("#personListPanel").hide()}),$("body").click(function(){$("#emojiList").removeClass("showList"),$("body").unbind(),$("body").click(function(e){"aPersonListPanel"!==$(e.target).closest("a").attr("id")&&"personListPanel"!==$(e.target).closest(".module").attr("id")&&$("#personListPanel").hide()})})},100))}),ArticleChannel.init(Label.articleChannel),Label.isLoggedIn&&(Article.makeNotificationRead(Label.articleOId,Label.notificationCmtIds),setTimeout(function(){Util.setUnreadNotificationCount()},1e3))});